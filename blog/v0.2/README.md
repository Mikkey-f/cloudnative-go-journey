# v0.2 åšå®¢ç³»åˆ—

> CloudNative Go Journey v0.2 - Kubernetes å·¥ä½œè´Ÿè½½æ·±åº¦å®è·µ

---

## ğŸ“š ç³»åˆ—æ–‡ç« 

### ç¬¬ 4 ç¯‡ï¼šK8s å·¥ä½œè´Ÿè½½å®Œå…¨æŒ‡å—

**æ–‡ä»¶**ï¼š[04-k8s-workloads-guide.md](./04-k8s-workloads-guide.md)

**å†…å®¹æ¦‚è§ˆ**ï¼š
- ä¸ºä»€ä¹ˆéœ€è¦å¤šç§å·¥ä½œè´Ÿè½½ï¼Ÿ
- Deploymentã€StatefulSetã€DaemonSetã€CronJob å¯¹æ¯”
- é€‰æ‹©å†³ç­–æ ‘å’Œæœ€ä½³å®è·µ
- å®æˆ˜å¯¹æ¯”ï¼šç”¨ä¸åŒæ–¹å¼éƒ¨ç½² Redis

**é€‚åˆäººç¾¤**ï¼š
- å®Œæˆ v0.1 çš„å­¦ä¹ è€…
- äº†è§£ Deploymentï¼Œæƒ³å­¦ä¹ å…¶ä»–å·¥ä½œè´Ÿè½½
- æƒ³ç³»ç»Ÿç†è§£ K8s å·¥ä½œè´Ÿè½½ä½“ç³»

**å­—æ•°**ï¼š~8000 å­—  
**é˜…è¯»æ—¶é—´**ï¼š30 åˆ†é’Ÿ

---

### ç¬¬ 5 ç¯‡ï¼šç”¨ StatefulSet éƒ¨ç½² Redis

**æ–‡ä»¶**ï¼š[05-statefulset-redis-practice.md](./05-statefulset-redis-practice.md)

**å†…å®¹æ¦‚è§ˆ**ï¼š
- ä¸ºä»€ä¹ˆ Redis éœ€è¦ StatefulSetï¼Ÿ
- Headless Service è¯¦è§£
- volumeClaimTemplates æŒä¹…åŒ–å­˜å‚¨
- æ•°æ®æŒä¹…åŒ–æµ‹è¯•ï¼ˆPod é‡å¯æ•°æ®ä¸ä¸¢å¤±ï¼‰
- å®Œæ•´çš„æ’æŸ¥æŒ‡å—

**é€‚åˆäººç¾¤**ï¼š
- éœ€è¦éƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨çš„å¼€å‘è€…
- æƒ³ç†è§£æŒä¹…åŒ–å­˜å‚¨çš„åŸç†
- å‡†å¤‡éƒ¨ç½²æ•°æ®åº“ã€ç¼“å­˜æœåŠ¡

**å­—æ•°**ï¼š~10000 å­—  
**é˜…è¯»æ—¶é—´**ï¼š40 åˆ†é’Ÿ

**æ ¸å¿ƒæ”¶è·**ï¼š
- âœ… StatefulSet çš„ 3 å¤§ç‰¹æ€§ï¼šå›ºå®šåç§°ã€å›ºå®šå­˜å‚¨ã€å›ºå®š DNS
- âœ… Headless Service åŸç†
- âœ… æ•°æ®æŒä¹…åŒ–å®æˆ˜éªŒè¯

---

### ç¬¬ 6 ç¯‡ï¼šDaemonSet å®æˆ˜æ—¥å¿—é‡‡é›†å™¨

**æ–‡ä»¶**ï¼š[06-daemonset-log-collector.md](./06-daemonset-log-collector.md)

**å†…å®¹æ¦‚è§ˆ**ï¼š
- DaemonSet çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆæ¯ä¸ªèŠ‚ç‚¹è‡ªåŠ¨éƒ¨ç½²ï¼‰
- ç¯å¢ƒå˜é‡æ³¨å…¥ï¼ˆfieldRefï¼‰
- è®¿é—®å®¿ä¸»æœºèµ„æºï¼ˆhostPathï¼‰
- tolerations å’Œ nodeSelector è¯¦è§£
- æ»šåŠ¨æ›´æ–°ç­–ç•¥

**é€‚åˆäººç¾¤**ï¼š
- éœ€è¦éƒ¨ç½²èŠ‚ç‚¹çº§æœåŠ¡çš„è¿ç»´äººå‘˜
- æƒ³å­¦ä¹ æ—¥å¿—é‡‡é›†ã€ç›‘æ§ Agent éƒ¨ç½²
- éœ€è¦è®¿é—®å®¿ä¸»æœºèµ„æºçš„åœºæ™¯

**å­—æ•°**ï¼š~7000 å­—  
**é˜…è¯»æ—¶é—´**ï¼š30 åˆ†é’Ÿ

**æ ¸å¿ƒæ”¶è·**ï¼š
- âœ… æ¯ä¸ªèŠ‚ç‚¹è‡ªåŠ¨è¿è¡Œä¸€ä¸ª Pod
- âœ… èŠ‚ç‚¹æ‰©ç¼©å®¹è‡ªåŠ¨é€‚åº”
- âœ… hostPath è®¿é—®å®¿ä¸»æœºç›®å½•

---

### ç¬¬ 7 ç¯‡ï¼šConfigMap å’Œ Secret é…ç½®ç®¡ç†

**æ–‡ä»¶**ï¼š[07-configmap-secret-guide.md](./07-configmap-secret-guide.md)

**å†…å®¹æ¦‚è§ˆ**ï¼š
- ConfigMap çš„ 4 ç§ä½¿ç”¨æ–¹å¼
- Secret åŠ å¯†å­˜å‚¨å’Œå®‰å…¨å®è·µ
- CronJob å®šæ—¶ä»»åŠ¡é…ç½®è¯¦è§£
- é…ç½®çš„åŠ¨æ€æ›´æ–°
- æœ€ä½³å®è·µå’Œå‘½åè§„èŒƒ

**é€‚åˆäººç¾¤**ï¼š
- éœ€è¦ç®¡ç†åº”ç”¨é…ç½®çš„å¼€å‘è€…
- æƒ³å­¦ä¹ é…ç½®å’Œä»£ç åˆ†ç¦»
- éœ€è¦ç®¡ç†æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ã€Tokenï¼‰

**å­—æ•°**ï¼š~9000 å­—  
**é˜…è¯»æ—¶é—´**ï¼š35 åˆ†é’Ÿ

**æ ¸å¿ƒæ”¶è·**ï¼š
- âœ… é…ç½®é›†ä¸­ç®¡ç†
- âœ… Secret å®‰å…¨å­˜å‚¨
- âœ… CronJob å®šæ—¶ä»»åŠ¡é…ç½®
- âœ… é…ç½®åˆ†å±‚å’Œç‰ˆæœ¬ç®¡ç†

---

### ç¬¬ 8 ç¯‡ï¼šCronJob å®æˆ˜å®šæ—¶æ¸…ç†ä»»åŠ¡

**æ–‡ä»¶**ï¼š[08-cronjob-cleanup-practice.md](./08-cronjob-cleanup-practice.md)

**å†…å®¹æ¦‚è§ˆ**ï¼š
- ä¸ºä»€ä¹ˆéœ€è¦ CronJobï¼Ÿï¼ˆvs ä¼ ç»Ÿ crontabï¼‰
- Job vs CronJob çš„åŒºåˆ«
- ç¼–å†™ Redis æ¸…ç†ä»»åŠ¡
- è°ƒåº¦è¡¨è¾¾å¼å’Œå¹¶å‘ç­–ç•¥
- å¤±è´¥å¤„ç†å’Œé‡è¯•æœºåˆ¶
- å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯æµç¨‹

**é€‚åˆäººç¾¤**ï¼š
- éœ€è¦å®ç°å®šæ—¶ä»»åŠ¡çš„å¼€å‘è€…
- æƒ³å­¦ä¹  K8s æ‰¹å¤„ç†ä»»åŠ¡
- éœ€è¦å®šæ—¶æ¸…ç†ã€å¤‡ä»½ã€æŠ¥è¡¨çš„åœºæ™¯

**å­—æ•°**ï¼š~11000 å­—  
**é˜…è¯»æ—¶é—´**ï¼š45 åˆ†é’Ÿ

**æ ¸å¿ƒæ”¶è·**ï¼š
- âœ… CronJob å®Œæ•´å®æˆ˜ï¼ˆä»ç¼–ç åˆ°éƒ¨ç½²ï¼‰
- âœ… 3 ç§å¹¶å‘ç­–ç•¥æ·±åº¦è§£æ
- âœ… å¤±è´¥é‡è¯•å’Œæ—¥å¿—æ’æŸ¥
- âœ… ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–å»ºè®®

---

## ğŸ¯ å­¦ä¹ è·¯çº¿

```
ç¬¬ 4 ç¯‡ï¼šK8s å·¥ä½œè´Ÿè½½å…¨æ™¯å›¾
  â†“ å»ºç«‹çŸ¥è¯†æ¡†æ¶
  
ç¬¬ 5 ç¯‡ï¼šStatefulSet æ·±åº¦å®è·µ
  â†“ æŒæ¡æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²
  
ç¬¬ 6 ç¯‡ï¼šDaemonSet èŠ‚ç‚¹æœåŠ¡
  â†“ æŒæ¡èŠ‚ç‚¹çº§æœåŠ¡éƒ¨ç½²
  
ç¬¬ 7 ç¯‡ï¼šé…ç½®ç®¡ç†æœ€ä½³å®è·µ
  â†“ æŒæ¡é…ç½®å’Œå¯†é’¥ç®¡ç†
  
ç¬¬ 8 ç¯‡ï¼šCronJob å®šæ—¶ä»»åŠ¡å®æˆ˜
  â†“ å®Œæˆ v0.2 å­¦ä¹ 
```

---

## ğŸ“Š v0.2 æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|-----|
| Kubernetes | 1.28+ | å®¹å™¨ç¼–æ’ |
| Go | 1.23 | API æœåŠ¡ã€æ—¥å¿—é‡‡é›†å™¨ |
| Redis | 7.4 | ç¼“å­˜æœåŠ¡ |
| Prometheus | latest | æŒ‡æ ‡é‡‡é›† |
| Docker | latest | å®¹å™¨è¿è¡Œæ—¶ |
| Minikube | latest | æœ¬åœ° K8s ç¯å¢ƒ |

---

## ğŸ—ï¸ v0.2 æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  K8s é›†ç¾¤                            â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Deployment: api-server (2 å‰¯æœ¬)           â”‚    â”‚
â”‚  â”‚  - ConfigMap: api-config                   â”‚    â”‚
â”‚  â”‚  - Service: api-service (NodePort)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  StatefulSet: redis (1 å‰¯æœ¬)               â”‚    â”‚
â”‚  â”‚  - ConfigMap: redis-config                 â”‚    â”‚
â”‚  â”‚  - Service: redis-service (Headless)       â”‚    â”‚
â”‚  â”‚  - PVC: data-redis-0 (1Gi)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DaemonSet: log-collector                  â”‚    â”‚
â”‚  â”‚  - æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª Pod                     â”‚    â”‚
â”‚  â”‚  - æŒ‚è½½ hostPath: /var/log                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CronJob: cleanup-job                      â”‚    â”‚
â”‚  â”‚  - æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡                           â”‚    â”‚
â”‚  â”‚  - æ¸…ç† Redis è¿‡æœŸé”®                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. éƒ¨ç½² Redis (StatefulSet)

```bash
kubectl apply -f k8s/v0.2/redis/configmap.yaml
kubectl apply -f k8s/v0.2/redis/service.yaml
kubectl apply -f k8s/v0.2/redis/statefulset.yaml
```

### 2. éƒ¨ç½² API æœåŠ¡ (Deployment)

```bash
# æ„å»ºé•œåƒ
minikube docker-env | Invoke-Expression
docker build -t cloudnative-go-api:v0.2 .

# éƒ¨ç½²
kubectl apply -f k8s/v0.2/api/configmap.yaml
kubectl apply -f k8s/v0.2/api/service.yaml
kubectl apply -f k8s/v0.2/api/deployment.yaml
```

### 3. éƒ¨ç½²æ—¥å¿—é‡‡é›†å™¨ (DaemonSet)

```bash
# æ„å»ºé•œåƒ
docker build -f Dockerfile.log-collector -t log-collector:v0.2 .

# éƒ¨ç½²
kubectl apply -f k8s/v0.2/log-collector/daemonset.yaml
```

### 4. éƒ¨ç½²æ¸…ç†ä»»åŠ¡ (CronJob)

```bash
# æ„å»ºé•œåƒ
docker build -f Dockerfile.cleanup-job -t cleanup-job:v0.2 .

# éƒ¨ç½²
kubectl apply -f k8s/v0.2/cleanup-job/cronjob.yaml
```

### 5. éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æ‰€æœ‰ Pod
kubectl get pods -o wide

# æŸ¥çœ‹æ‰€æœ‰ Service
kubectl get svc

# æŸ¥çœ‹ CronJob
kubectl get cronjobs

# æŸ¥çœ‹ DaemonSet
kubectl get daemonsets
```

---

## ğŸ“ v0.2 ç»Ÿè®¡æ•°æ®

**5 ç¯‡å®æˆ˜åšå®¢ï¼Œæ€»è®¡ ~45000 å­—ï¼š**
- ç¬¬ 4 ç¯‡ï¼šK8s å·¥ä½œè´Ÿè½½å®Œå…¨æŒ‡å—ï¼ˆ~8000å­—ï¼‰
- ç¬¬ 5 ç¯‡ï¼šStatefulSet éƒ¨ç½² Redisï¼ˆ~10000å­—ï¼‰
- ç¬¬ 6 ç¯‡ï¼šDaemonSet æ—¥å¿—é‡‡é›†å™¨ï¼ˆ~7000å­—ï¼‰
- ç¬¬ 7 ç¯‡ï¼šConfigMap å’Œ Secretï¼ˆ~9000å­—ï¼‰
- ç¬¬ 8 ç¯‡ï¼šCronJob å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆ~11000å­—ï¼‰

---

## ğŸ“ v0.2 å­¦ä¹ æˆæœ

å®Œæˆ v0.2 åï¼Œä½ å°†æŒæ¡ï¼š

**å·¥ä½œè´Ÿè½½ç®¡ç†ï¼š**
- âœ… Deploymentï¼šæ— çŠ¶æ€åº”ç”¨éƒ¨ç½²
- âœ… StatefulSetï¼šæœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²ï¼ˆRedisï¼‰
- âœ… DaemonSetï¼šèŠ‚ç‚¹çº§æœåŠ¡éƒ¨ç½²ï¼ˆæ—¥å¿—é‡‡é›†ï¼‰
- âœ… Job/CronJobï¼šæ‰¹å¤„ç†å’Œå®šæ—¶ä»»åŠ¡ï¼ˆæ•°æ®æ¸…ç†ï¼‰

**å­˜å‚¨ç®¡ç†ï¼š**
- âœ… PVC/PVï¼šæŒä¹…åŒ–å­˜å‚¨
- âœ… volumeClaimTemplatesï¼šåŠ¨æ€å­˜å‚¨åˆ†é…
- âœ… hostPathï¼šè®¿é—®å®¿ä¸»æœºèµ„æº

**ç½‘ç»œç®¡ç†ï¼š**
- âœ… Headless Serviceï¼šå›ºå®š DNS è§£æ
- âœ… NodePort Serviceï¼šå¤–éƒ¨è®¿é—®

**é…ç½®ç®¡ç†ï¼š**
- âœ… ConfigMapï¼šé…ç½®æ•°æ®ç®¡ç†
- âœ… Secretï¼šæ•æ„Ÿæ•°æ®ç®¡ç†
- âœ… ç¯å¢ƒå˜é‡æ³¨å…¥
- âœ… æ–‡ä»¶æŒ‚è½½

**é«˜çº§ç‰¹æ€§ï¼š**
- âœ… æ»šåŠ¨æ›´æ–°ç­–ç•¥
- âœ… å¥åº·æ£€æŸ¥ï¼ˆLiveness/Readinessï¼‰
- âœ… èµ„æºé™åˆ¶ï¼ˆrequests/limitsï¼‰
- âœ… èŠ‚ç‚¹é€‰æ‹©å’Œå®¹å¿ï¼ˆnodeSelector/tolerationsï¼‰

---

## ğŸ”— ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Kubernetes å·¥ä½œè´Ÿè½½](https://kubernetes.io/docs/concepts/workloads/)
- [StatefulSet](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/)
- [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/)
- [ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/)
- [Secret](https://kubernetes.io/docs/concepts/configuration/secret/)

### é¡¹ç›®æ–‡æ¡£
- [v0.2 å®Œæ•´æ–‡æ¡£](../../docs/v0.2/)
- [éƒ¨ç½²æŒ‡å—](../../k8s/v0.2/README.md)
- [è‡ªåŠ¨åŒ–è„šæœ¬](../../scripts/deploy-v0.2.ps1)

---

## ğŸ“ˆ æ¥ä¸‹æ¥

**v0.3 é¢„å‘Šï¼šé«˜çº§ç½‘ç»œå’Œç›‘æ§**
- Ingressï¼šç»Ÿä¸€å…¥å£å’Œè·¯ç”±
- NetworkPolicyï¼šç½‘ç»œéš”ç¦»
- Prometheus + Grafanaï¼šå®Œæ•´ç›‘æ§æ–¹æ¡ˆ
- HPAï¼šæ°´å¹³è‡ªåŠ¨æ‰©ç¼©å®¹

**v1.0 ç›®æ ‡ï¼šç”Ÿäº§çº§éƒ¨ç½²**
- Helmï¼šåº”ç”¨åŒ…ç®¡ç†
- CI/CDï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²
- é«˜å¯ç”¨æ¶æ„
- æ€§èƒ½ä¼˜åŒ–

---

## ğŸ¤ å‚ä¸è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](../../LICENSE) æ–‡ä»¶ã€‚

---

**å¦‚æœè¿™ä¸ªç³»åˆ—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Starï¼**

