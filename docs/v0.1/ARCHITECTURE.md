# v0.1 æ¶æ„å’Œæµé‡è·¯å¾„è¯¦è§£

> ç”¨å›¾å½¢åŒ–æ–¹å¼ç†è§£ Kubernetes ç½‘ç»œå’ŒèŠ‚ç‚¹æ¦‚å¿µ

---

## ğŸ—ï¸ å®Œæ•´æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä½ çš„ Windows ç”µè„‘ï¼ˆå®¿ä¸»æœºï¼‰                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚   æµè§ˆå™¨/curl   â”‚  ç”¨æˆ·å‘èµ·è¯·æ±‚                                           â”‚
â”‚  â”‚                â”‚  http://127.0.0.1:62218/health                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  æˆ–                                                     â”‚
â”‚           â”‚          http://192.168.49.2:30080/health                       â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â†“                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Minikube æœåŠ¡éš§é“ï¼ˆå¯é€‰ï¼‰                                  â”‚            â”‚
â”‚  â”‚  127.0.0.1:62218 â†’ 192.168.49.2:30080                      â”‚            â”‚
â”‚  â”‚  ä½œç”¨ï¼šæ¡¥æ¥ Windows ç½‘ç»œåˆ° Minikube è™šæ‹Ÿç½‘ç»œ               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                   â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ ç½‘ç»œè¯·æ±‚
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Docker Desktop / Minikube VM                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Kubernetes èŠ‚ç‚¹ï¼ˆNodeï¼‰                             â”‚ â”‚
â”‚  â”‚                    IP: 192.168.49.2                                    â”‚ â”‚
â”‚  â”‚                    åç§°: minikube                                       â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  1ï¸âƒ£  NodePort ç«¯å£ç›‘å¬ï¼ˆiptables è§„åˆ™ï¼‰                      â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      ç«¯å£: 30080                                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      ä½œç”¨: æ¥æ”¶å¤–éƒ¨æµé‡                                       â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                       â”‚                                               â”‚ â”‚
â”‚  â”‚                       â†“                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  2ï¸âƒ£  kube-proxyï¼ˆç½‘ç»œä»£ç†ï¼‰                                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      è¯†åˆ«æµé‡ç›®æ ‡: api-service                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      æŸ¥æ‰¾ iptables/IPVS è§„åˆ™                                 â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                       â”‚                                               â”‚ â”‚
â”‚  â”‚                       â†“                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  3ï¸âƒ£  Serviceï¼ˆapi-serviceï¼‰                                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      ClusterIP: 10.96.123.45                                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      Port: 8080                                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      Selector: app=api                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      åŠŸèƒ½:                                                    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      1. æ ¹æ® selector æ‰¾åˆ°åŒ¹é…çš„ Pod                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      2. è´Ÿè½½å‡è¡¡ï¼ˆè½®è¯¢/éšæœºï¼‰                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      3. è½¬å‘åˆ° TargetPort: 8080                              â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                       â”‚                                               â”‚ â”‚
â”‚  â”‚                       â†“                                               â”‚ â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚ â”‚
â”‚  â”‚              â”‚  è´Ÿè½½å‡è¡¡é€‰æ‹©     â”‚                                     â”‚ â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚ â”‚
â”‚  â”‚                       â”‚                                               â”‚ â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚ â”‚
â”‚  â”‚         â†“                           â†“                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚  â”‚  4ï¸âƒ£  Pod 1       â”‚        â”‚  4ï¸âƒ£  Pod 2       â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  api-server-xxx  â”‚        â”‚  api-server-yyy  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  IP: 10.244.0.5  â”‚        â”‚  IP: 10.244.0.6  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  Labels:         â”‚        â”‚  Labels:         â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚    app=api       â”‚        â”‚    app=api       â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚    version=v0.1  â”‚        â”‚    version=v0.1  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚        â”‚                  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Container  â”‚  â”‚        â”‚  â”‚ Container  â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚            â”‚  â”‚        â”‚  â”‚            â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 5ï¸âƒ£  Go App â”‚  â”‚        â”‚  â”‚ 5ï¸âƒ£  Go App â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Port: 8080 â”‚  â”‚        â”‚  â”‚ Port: 8080 â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚            â”‚  â”‚        â”‚  â”‚ Port: 8080 â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ /health    â”‚  â”‚        â”‚  â”‚ /health    â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ /api/v1/*  â”‚  â”‚        â”‚  â”‚ /api/v1/*  â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ /metrics   â”‚  â”‚        â”‚  â”‚ /metrics   â”‚  â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Kubernetes æ ¸å¿ƒç»„ä»¶ï¼ˆåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼‰                                    â”‚ â”‚
â”‚  â”‚  - kubelet: ç®¡ç† Pod ç”Ÿå‘½å‘¨æœŸ                                          â”‚ â”‚
â”‚  â”‚  - kube-proxy: é…ç½®ç½‘ç»œè§„åˆ™                                            â”‚ â”‚
â”‚  â”‚  - Container Runtime (Docker): è¿è¡Œå®¹å™¨                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å…³é”®æ¦‚å¿µè¯¦è§£

### 1. ä»€ä¹ˆæ˜¯"èŠ‚ç‚¹"ï¼ˆNodeï¼‰ï¼Ÿ

```
èŠ‚ç‚¹ = ä¸€å°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼Œç”¨äºè¿è¡Œ Pod

åœ¨ä½ çš„ç¯å¢ƒä¸­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰©ç†æœºï¼ˆWindows ç”µè„‘ï¼‰      â”‚
â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Docker Desktop      â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Minikube VM    â”‚  â”‚  â”‚  â† è¿™å°±æ˜¯ "èŠ‚ç‚¹"
â”‚  â”‚  â”‚ (è™šæ‹Ÿæœº)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ IP: 192.168.49.2â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ åç§°: minikube  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èŠ‚ç‚¹çš„ä½œç”¨ï¼š
âœ… æä¾›è¿è¡Œç¯å¢ƒï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œï¼‰
âœ… è¿è¡Œ Kubernetes ç»„ä»¶ï¼ˆkubeletã€kube-proxyï¼‰
âœ… è¿è¡Œä½ çš„ Pod
âœ… ç®¡ç†å®¹å™¨ï¼ˆé€šè¿‡ Dockerï¼‰
```

---

### 2. èŠ‚ç‚¹ä¸Šæœ‰ä»€ä¹ˆï¼Ÿ

```
Minikube èŠ‚ç‚¹ï¼ˆ192.168.49.2ï¼‰
â”œâ”€â”€ Kubernetes ç»„ä»¶
â”‚   â”œâ”€â”€ kubelet        â†’ ç®¡ç† Podï¼ˆå¯åŠ¨ã€åœæ­¢ã€å¥åº·æ£€æŸ¥ï¼‰
â”‚   â”œâ”€â”€ kube-proxy     â†’ é…ç½®ç½‘ç»œè§„åˆ™ï¼ˆiptables/IPVSï¼‰
â”‚   â””â”€â”€ container-runtime â†’ Dockerï¼ˆè¿è¡Œå®¹å™¨ï¼‰
â”‚
â”œâ”€â”€ ç½‘ç»œç»„ä»¶
â”‚   â”œâ”€â”€ CNI æ’ä»¶       â†’ é…ç½® Pod ç½‘ç»œ
â”‚   â””â”€â”€ iptables è§„åˆ™  â†’ æµé‡è½¬å‘è§„åˆ™
â”‚
â”œâ”€â”€ ä½ çš„å·¥ä½œè´Ÿè½½
â”‚   â”œâ”€â”€ Pod 1 (IP: 10.244.0.5)
â”‚   â””â”€â”€ Pod 2 (IP: 10.244.0.6)
â”‚
â””â”€â”€ Kubernetes ç³»ç»Ÿ Pod
    â”œâ”€â”€ kube-dns
    â”œâ”€â”€ kube-proxy
    â””â”€â”€ ...
```

---

## ğŸŒŠ å®Œæ•´æµé‡è·¯å¾„ï¼ˆæ­¥éª¤è¯¦è§£ï¼‰

### æ­¥éª¤ 1: ç”¨æˆ·å‘èµ·è¯·æ±‚

```
ä½ åœ¨æµè§ˆå™¨è¾“å…¥ï¼š
http://127.0.0.1:62218/health
æˆ–
http://192.168.49.2:30080/health

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨   â”‚  curl http://127.0.0.1:62218/health
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â†“
Windows æœ¬åœ°ç½‘ç»œæ ˆï¼ˆ127.0.0.1:62218ï¼‰
```

---

### æ­¥éª¤ 2: Minikube éš§é“è½¬å‘ï¼ˆå¦‚æœä½¿ç”¨ minikube serviceï¼‰

```
minikube service api-service
  â†“
è‡ªåŠ¨åˆ›å»ºéš§é“: 127.0.0.1:62218 â†’ 192.168.49.2:30080

ä¸ºä»€ä¹ˆéœ€è¦éš§é“ï¼Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Windows ç½‘ç»œï¼š192.168.1.x                  â”‚  â† ä½ çš„ç”µè„‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• ç½‘ç»œéš”ç¦»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Minikube è™šæ‹Ÿç½‘ç»œï¼š192.168.49.x            â”‚  â† è™šæ‹Ÿæœº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›´æ¥è®¿é—®ä¸é€š âŒ
é€šè¿‡éš§é“å¯ä»¥è®¿é—® âœ…
```

**æˆ–è€…ç›´æ¥è®¿é—® NodePort**ï¼š
```
curl http://192.168.49.2:30080/health
  â†“
ç›´æ¥åˆ°èŠ‚ç‚¹çš„ 30080 ç«¯å£
```

---

### æ­¥éª¤ 3: åˆ°è¾¾èŠ‚ç‚¹çš„ NodePort

```
è¯·æ±‚åˆ°è¾¾: 192.168.49.2:30080

Minikube èŠ‚ç‚¹æ”¶åˆ°è¯·æ±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Minikube èŠ‚ç‚¹ (192.168.49.2) â”‚
â”‚                               â”‚
â”‚  ç›‘å¬ç«¯å£ï¼š                    â”‚
â”‚  - 30080 (NodePort)           â”‚
â”‚  - å…¶ä»–æœåŠ¡ç«¯å£...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â†“
      æŸ¥è¯¢ iptables è§„åˆ™
```

---

### æ­¥éª¤ 4: iptables è§„åˆ™åŒ¹é… Service

```
èŠ‚ç‚¹ä¸Šçš„ iptables è§„åˆ™ï¼ˆç”± kube-proxy ç»´æŠ¤ï¼‰ï¼š

è§„åˆ™ç¤ºä¾‹ï¼š
IF ç›®æ ‡ç«¯å£ = 30080
THEN è½¬å‘åˆ° ClusterIP 10.96.123.45:8080
     (api-service çš„ ClusterIP)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  iptables/IPVS è§„åˆ™                 â”‚
â”‚                                     â”‚
â”‚  30080 â†’ 10.96.123.45:8080         â”‚
â”‚          (api-service)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
         Service (api-service)
```

**iptables è§„åˆ™å®é™…ä¾‹å­**ï¼š
```bash
# åœ¨èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹ï¼ˆä»…ç¤ºæ„ï¼‰
iptables -t nat -L -n | grep 30080

# è¾“å‡ºç±»ä¼¼ï¼š
DNAT  tcp  --  0.0.0.0/0  0.0.0.0/0  tcp dpt:30080 to:10.96.123.45:8080
```

---

### æ­¥éª¤ 5: Service é€‰æ‹© Pod

```
Service (api-service)
  ClusterIP: 10.96.123.45
  Port: 8080
  Selector: app=api
  TargetPort: 8080

Service çš„å·¥ä½œï¼š
1ï¸âƒ£  æŸ¥è¯¢ Endpoints
    "å“ªäº› Pod æœ‰ app=api æ ‡ç­¾ï¼Ÿ"
    
    æŸ¥è¯¢ç»“æœï¼š
    - 10.244.0.5:8080 (Pod 1) âœ…
    - 10.244.0.6:8080 (Pod 2) âœ…

2ï¸âƒ£  è´Ÿè½½å‡è¡¡
    é€‰æ‹©ä¸€ä¸ª Podï¼ˆè½®è¯¢/éšæœºï¼‰
    
    è¿™æ¬¡é€‰æ‹©: 10.244.0.5:8080 (Pod 1)

3ï¸âƒ£  è½¬å‘æµé‡
    ç›®æ ‡: 10.244.0.5:8080
```

**Endpoints æŸ¥è¯¢**ï¼š
```bash
kubectl get endpoints api-service

# è¾“å‡ºï¼š
NAME          ENDPOINTS
api-service   10.244.0.5:8080,10.244.0.6:8080
```

---

### æ­¥éª¤ 6: æµé‡åˆ°è¾¾ Pod

```
è¯·æ±‚åˆ°è¾¾: Pod 1 (10.244.0.5:8080)

Pod å†…éƒ¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod (api-server-xxx)      â”‚
â”‚  IP: 10.244.0.5            â”‚
â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Container (api)     â”‚  â”‚
â”‚  â”‚  Port: 8080          â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚  ç›‘å¬ :8080          â”‚  â”‚
â”‚  â”‚    â†“                 â”‚  â”‚
â”‚  â”‚  Go åº”ç”¨å¤„ç†è¯·æ±‚     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤ 7: Go åº”ç”¨å¤„ç†è¯·æ±‚

```go
// src/main.go
router.GET("/health", handler.HealthCheck)

// æ‰§è¡Œ handler.HealthCheck
func HealthCheck(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "status": "healthy",
        "uptime": time.Since(startTime).String(),
    })
}

// è¿”å›å“åº”ï¼š
{
  "status": "healthy",
  "uptime": "5m30s"
}
```

---

### æ­¥éª¤ 8: å“åº”åŸè·¯è¿”å›

```
å“åº”è·¯å¾„ï¼ˆé€†å‘ï¼‰ï¼š

Go åº”ç”¨
  â†“
Container (Port 8080)
  â†“
Pod (10.244.0.5:8080)
  â†“
Service (10.96.123.45:8080)
  â†“
iptables è§„åˆ™è½¬æ¢
  â†“
NodePort (192.168.49.2:30080)
  â†“
Minikube éš§é“ï¼ˆå¦‚æœæœ‰ï¼‰
  â†“
Windows (127.0.0.1:62218)
  â†“
æµè§ˆå™¨æ˜¾ç¤ºç»“æœ âœ…
```

---

## ğŸ” ç½‘ç»œå±‚æ¬¡è¯¦è§£

### Layer 1: ç‰©ç†/è™šæ‹Ÿç½‘ç»œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Windows ç‰©ç†ç½‘ç»œ               â”‚
â”‚  192.168.1.x                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Bridge ç½‘ç»œ             â”‚
â”‚  (NAT)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Minikube è™šæ‹Ÿæœºç½‘ç»œ            â”‚
â”‚  192.168.49.x                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Layer 2: Kubernetes ç½‘ç»œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹ç½‘ç»œ                        â”‚
â”‚  192.168.49.2                   â”‚
â”‚  (Node IP)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service ç½‘ç»œï¼ˆè™šæ‹Ÿï¼‰            â”‚
â”‚  10.96.0.0/12                   â”‚
â”‚  (ClusterIP èŒƒå›´)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod ç½‘ç»œ                        â”‚
â”‚  10.244.0.0/16                  â”‚
â”‚  (Pod IP èŒƒå›´)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Layer 3: ç«¯å£æ˜ å°„

```
å¤–éƒ¨ç«¯å£               Service ç«¯å£          Pod ç«¯å£
(NodePort)            (ClusterIP:Port)     (Pod IP:TargetPort)

30080        â†’        10.96.123.45:8080  â†’  10.244.0.5:8080
(èŠ‚ç‚¹)                 (Service è™šæ‹ŸIP)      (Pod å®é™…IP)
```

---

## ğŸ’¡ é‡è¦æ¦‚å¿µå¯¹æ¯”

### NodePort vs ClusterIP vs Pod IP

```
NodePort: 30080
  - åœ¨èŠ‚ç‚¹ä¸Šæš´éœ²çš„ç«¯å£
  - å¤–éƒ¨å¯è®¿é—®
  - èŒƒå›´: 30000-32767

ClusterIP: 10.96.123.45:8080
  - Service çš„è™šæ‹Ÿ IP
  - åªåœ¨é›†ç¾¤å†…æœ‰æ•ˆ
  - ç¨³å®šä¸å˜

Pod IP: 10.244.0.5:8080
  - Pod çš„å®é™… IP
  - åªåœ¨é›†ç¾¤å†…æœ‰æ•ˆ
  - Pod é‡å¯ä¼šå˜
```

---

### Service çš„ä½œç”¨

```
æ²¡æœ‰ Serviceï¼š
  - ä½ éœ€è¦çŸ¥é“æ¯ä¸ª Pod çš„ IP
  - Pod é‡å¯å IP å˜äº†ï¼Œè®¿é—®å°±æ–­äº† âŒ

æœ‰ Serviceï¼š
  - ä½ åªéœ€è¦çŸ¥é“ Service åç§°
  - Service è‡ªåŠ¨è·Ÿè¸ª Pod IP å˜åŒ–
  - è‡ªåŠ¨è´Ÿè½½å‡è¡¡ âœ…
```

---

## ğŸ¯ éªŒè¯æµé‡è·¯å¾„

### 1. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯

```powershell
# æŸ¥çœ‹èŠ‚ç‚¹
kubectl get nodes -o wide

# è¾“å‡ºï¼š
NAME       STATUS   ROLES    AGE   VERSION   INTERNAL-IP      OS-IMAGE
minikube   Ready    master   1d    v1.28.3   192.168.49.2     Ubuntu 22.04
                                              â†‘ èŠ‚ç‚¹ IP
```

---

### 2. æŸ¥çœ‹ Service ä¿¡æ¯

```powershell
kubectl get svc api-service

# è¾“å‡ºï¼š
NAME          TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
api-service   NodePort   10.96.123.45    <none>        8080:30080/TCP   1h
                         â†‘ Service IP              â†‘ Service:NodePort
```

---

### 3. æŸ¥çœ‹ Pod ä¿¡æ¯

```powershell
kubectl get pods -o wide

# è¾“å‡ºï¼š
NAME                READY   STATUS    IP            NODE
api-server-xxx      1/1     Running   10.244.0.5    minikube
api-server-yyy      1/1     Running   10.244.0.6    minikube
                                      â†‘ Pod IP      â†‘ è¿è¡Œåœ¨è¿™ä¸ªèŠ‚ç‚¹
```

---

### 4. æŸ¥çœ‹ Endpoints

```powershell
kubectl get endpoints api-service

# è¾“å‡ºï¼š
NAME          ENDPOINTS
api-service   10.244.0.5:8080,10.244.0.6:8080
              â†‘ Service æ‰¾åˆ°çš„ Pod IP åˆ—è¡¨
```

---

### 5. æµ‹è¯•è®¿é—®è·¯å¾„

```powershell
# æ–¹æ³• 1ï¼šé€šè¿‡ minikube serviceï¼ˆè‡ªåŠ¨éš§é“ï¼‰
minikube service api-service
# è‡ªåŠ¨æ‰“å¼€: http://127.0.0.1:62218/...

# æ–¹æ³• 2ï¼šç›´æ¥è®¿é—® NodePort
curl http://192.168.49.2:30080/health

# æ–¹æ³• 3ï¼šé›†ç¾¤å†…è®¿é—®ï¼ˆéœ€è¦è¿›å…¥ Podï¼‰
kubectl run test --image=alpine --rm -it -- sh
wget -qO- http://api-service:8080/health
wget -qO- http://10.244.0.5:8080/health
```

---

## ğŸ“Š å®Œæ•´æµé‡è¿½è¸ª

### ä½¿ç”¨ tcpdump è¿½è¸ªï¼ˆé«˜çº§ï¼‰

```bash
# SSH åˆ° Minikube èŠ‚ç‚¹
minikube ssh

# ç›‘å¬ NodePort æµé‡
sudo tcpdump -i any -nn port 30080

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯å‘é€è¯·æ±‚
curl http://192.168.49.2:30080/health

# ä½ ä¼šçœ‹åˆ°ï¼š
# 192.168.1.x â†’ 192.168.49.2:30080  ï¼ˆè¯·æ±‚åˆ°è¾¾èŠ‚ç‚¹ï¼‰
# 192.168.49.2 â†’ 10.244.0.5:8080    ï¼ˆè½¬å‘åˆ° Podï¼‰
# 10.244.0.5:8080 â†’ 192.168.49.2    ï¼ˆPod å“åº”ï¼‰
# 192.168.49.2:30080 â†’ 192.168.1.x  ï¼ˆè¿”å›ç»™å®¢æˆ·ç«¯ï¼‰
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

```
èŠ‚ç‚¹ï¼ˆNodeï¼‰= è¿è¡Œ Pod çš„æœºå™¨ï¼ˆç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰
  - ä½ çš„ç¯å¢ƒä¸­ï¼šMinikube VM (192.168.49.2)
  - ä½œç”¨ï¼šæä¾›è¿è¡Œç¯å¢ƒã€ç½‘ç»œã€å­˜å‚¨

Service = è´Ÿè½½å‡è¡¡å™¨ + æœåŠ¡å‘ç°
  - æä¾›ç¨³å®šçš„è®¿é—®å…¥å£
  - è‡ªåŠ¨è·Ÿè¸ª Pod IP å˜åŒ–
  - è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ª Pod

Pod = å®¹å™¨çš„é›†åˆ
  - æœ€å°éƒ¨ç½²å•å…ƒ
  - æœ‰è‡ªå·±çš„ IP
  - è¿è¡Œä½ çš„åº”ç”¨å®¹å™¨
```

---

### å®Œæ•´æµé‡è·¯å¾„ï¼ˆä¸€å¥è¯ï¼‰

```
æµè§ˆå™¨ 
  â†’ Minikube éš§é“ï¼ˆå¯é€‰ï¼‰
  â†’ èŠ‚ç‚¹ NodePort (192.168.49.2:30080)
  â†’ iptables è§„åˆ™è½¬æ¢
  â†’ Service ClusterIP (10.96.123.45:8080)
  â†’ è´Ÿè½½å‡è¡¡é€‰æ‹© Pod
  â†’ Pod IP (10.244.0.5:8080)
  â†’ Container å¤„ç†è¯·æ±‚
  â†’ å“åº”åŸè·¯è¿”å›
```

---

**ç°åœ¨æ¸…æ¥šäº†å—ï¼Ÿ** èŠ‚ç‚¹å°±æ˜¯è¿è¡Œ Pod çš„"åœ°åŸº"ï¼Œè€Œ Service æ˜¯"è·¯ç”±å™¨"ï¼ŒæŠŠæµé‡ä»èŠ‚ç‚¹ç«¯å£å¯¼åˆ°æ­£ç¡®çš„ Podï¼ğŸ¯
